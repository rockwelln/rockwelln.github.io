<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>1337</title><link>https://rockwelln.github.io/</link><description>Recent content on 1337</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Thu, 19 May 2022 10:03:56 +0200</lastBuildDate><atom:link href="https://rockwelln.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>Docker Basics</title><link>https://rockwelln.github.io/posts/docker-basics/</link><pubDate>Thu, 19 May 2022 10:03:56 +0200</pubDate><guid>https://rockwelln.github.io/posts/docker-basics/</guid><description>&lt;p>This is my reference article to introduce docker basic concepts.&lt;/p>
&lt;h2 id="agenda">Agenda&lt;/h2>
&lt;ol>
&lt;li>Overview
&lt;ol>
&lt;li>Why and What?&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;h2 id="why-do-you-need-docker">Why do you need docker?&lt;/h2>
&lt;p>Modern architectures usually involve existing services to handle some responsibilities in the service we want to offer.&lt;!-- raw HTML omitted -->
We want to use those services because we don&amp;rsquo;t have time to reinvent the wheel and they are robust, cheap/free, standard, &amp;hellip; name it (e.g nginx, haproxy, postgresql, redis, python, etc&amp;hellip;).&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>IT architecture is a moving target full of people with strong opinions. Each of these tools has it&amp;rsquo;s own list of requirements and (even if the team behind them is making a great job to ensure compatibility) there is no guarantee they will work properly together across versions, in the long run. &lt;!-- raw HTML omitted -->&lt;/p>
&lt;h3 id="typical-dependency-issue">Typical dependency issue&lt;/h3>
&lt;p>For some reason (customer&amp;rsquo;s requirement or OS limitation), you have to use NGINX version A (which is old).&lt;!-- raw HTML omitted -->
That version requires Openssl version X (which is old too).&lt;!-- raw HTML omitted -->
So you need python version B which requires Openssl version Y.&lt;!-- raw HTML omitted -->
This kind of conflict can be resolved with a lot of manual commands, difficult to explain to a new developper and difficult to maintain over time.&lt;!-- raw HTML omitted -->&lt;/p>
&lt;h3 id="platform-deprecation">Platform deprecation&lt;/h3>
&lt;p>Back in time, 8 years ago, Centos was known to be the most stable linux distribution. So we decided to use it as base requirement for our software.&lt;!-- raw HTML omitted -->
But today Centos is deprecated, only bug fixes and security patches are provided for Centos7 until June, 2024.&lt;!-- raw HTML omitted -->
(it means, for instance, Centos7 still ships python3.6 which is EOL since 12/2021 without any bug fixes or security patches).&lt;!-- raw HTML omitted -->&lt;/p>
&lt;h3 id="a-solution-attempt">A solution attempt&lt;/h3>
&lt;p>We, as software makers, don&amp;rsquo;t want to deal with those recurring problems.&lt;!-- raw HTML omitted -->
We want to have isolation of service dependencies and abstraction of the operating system.&lt;!-- raw HTML omitted -->&lt;/p>
&lt;h2 id="living-in-a-limited-environment">Living in a limited environment&lt;/h2>
&lt;h3 id="reading-files">Reading files&lt;/h3>
&lt;p>You can usually use &lt;code>cat&lt;/code> for small files or &lt;code>less&lt;/code> for bigger files&lt;/p>
&lt;h3 id="patch-files">Patch files&lt;/h3>
&lt;p>Sometimes we want to patch just a couple of files in a running container.&lt;!-- raw HTML omitted -->
But because the container is light weight, usually there is no editor (e.g vi, vim or nano) present in the image.&lt;!-- raw HTML omitted -->&lt;/p>
&lt;h4 id="first-attempt-for-text-files-sed">First attempt for text files (sed)&lt;/h4>
&lt;p>Sed is a very common program in the Linux world and is present in most distro and images (even the slim ones).&lt;!-- raw HTML omitted -->
Usually scary for beginners using the command line, you can use it as such:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sed &lt;span style="color:#e6db74">&amp;#39;s/&amp;lt;old string&amp;gt;/&amp;lt;new string&amp;gt;/g&amp;#39;&lt;/span> &amp;lt;text_file&amp;gt; &amp;gt; &amp;lt;new_file&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>For instance&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># replace the host ip address in some config file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sed &lt;span style="color:#e6db74">&amp;#39;s/host=127.0.0.1/host=1.2.3.4/g&amp;#39;&lt;/span> config.yml &amp;gt; newConfig.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># check the modification applied only where you expect it&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>diff config.yml newConfig.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#3c3d38">&lt;span>&lt;span style="color:#75715e"># if you are fine with it, backup and replace the original&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#3c3d38">&lt;span>cp -v config.yml config.yml.bkp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mv -v newConfig.yml config.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="more-complex-situation">More complex situation&lt;/h4>
&lt;p>When you need to patch a folder or binaries, &lt;code>sed&lt;/code> will be no help.&lt;!-- raw HTML omitted -->&lt;/p>
&lt;div class="highlight">&lt;div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
&lt;table style="border-spacing:0;padding:0;margin:0;border:0;">&lt;tr>&lt;td style="vertical-align:top;padding:0;margin:0;border:0;">
&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">&lt;code>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
&lt;/span>&lt;span style="background-color:#3c3d38">&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
&lt;/span>&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
&lt;/span>&lt;span style="background-color:#3c3d38">&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
&lt;/span>&lt;/span>&lt;span style="background-color:#3c3d38">&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
&lt;/span>&lt;/span>&lt;span style="background-color:#3c3d38">&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
&lt;/span>&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
&lt;/span>&lt;span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// GetTitleFunc returns a func that can be used to transform a string to
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// title case.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// The supported styles are
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// - &amp;#34;Go&amp;#34; (strings.Title)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// - &amp;#34;AP&amp;#34; (see https://www.apstylebook.com/)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#3c3d38">&lt;span>&lt;span style="color:#75715e">// - &amp;#34;Chicago&amp;#34; (see https://www.chicagomanualofstyle.org/home.html)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// If an unknown or empty style is provided, AP style is what you get.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">GetTitleFunc&lt;/span>(&lt;span style="color:#a6e22e">style&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span>) &lt;span style="color:#66d9ef">func&lt;/span>(&lt;span style="color:#a6e22e">s&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span>) &lt;span style="color:#66d9ef">string&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> &lt;span style="color:#a6e22e">strings&lt;/span>.&lt;span style="color:#a6e22e">ToLower&lt;/span>(&lt;span style="color:#a6e22e">style&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#34;go&amp;#34;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">strings&lt;/span>.&lt;span style="color:#a6e22e">Title&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#3c3d38">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#34;chicago&amp;#34;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#3c3d38">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">transform&lt;/span>.&lt;span style="color:#a6e22e">NewTitleConverter&lt;/span>(&lt;span style="color:#a6e22e">transform&lt;/span>.&lt;span style="color:#a6e22e">ChicagoStyle&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#3c3d38">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">transform&lt;/span>.&lt;span style="color:#a6e22e">NewTitleConverter&lt;/span>(&lt;span style="color:#a6e22e">transform&lt;/span>.&lt;span style="color:#a6e22e">APStyle&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item></channel></rss>